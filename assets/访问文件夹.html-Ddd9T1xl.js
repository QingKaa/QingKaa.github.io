import{_ as i,r as t,o as c,c as l,b as a,a as n,d as s,e as o}from"./app-OdtGcBzi.js";const r="/assets/vscode-demo-CYWLXz1U.png",u="data:image/png;base64,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",k="/assets/demo-CDL4Q_ks.png",d="/assets/handle-log-CuWNHK2r.png",h="/assets/log-info-BxgrGMQU.png",v={},m=n("h1",{id:"访问文件夹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#访问文件夹"},[n("span",null,"访问文件夹")])],-1),I={href:"https://qingkaa.github.io/demo/#/other/readFolders",target:"_blank",rel:"noopener noreferrer"},E={href:"https://vscode.dev/",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,[n("img",{src:r,alt:"vscode"})],-1),A=n("p",null,[s("这之前，因为浏览器的安全限制，前端一直是无法直接访问本地文件夹。现如今，一个新的API允许前端访问本地文件夹,前端的确是日新月异，一起来了解下这个API："),n("strong",null,"Window：showDirectoryPicker() 方法")],-1),y=n("h2",{id:"window-showdirectorypicker",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#window-showdirectorypicker"},[n("span",null,"Window：showDirectoryPicker()")])],-1),F={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/showDirectoryPicker",target:"_blank",rel:"noopener noreferrer"},g=o('<p><code>Window</code> 接口的 <code>showDirectoryPicker()</code> 方法用于显示一个目录选择器，以允许用户选择一个目录。</p><p>该方法返回一个 <code>FileSystemDirectoryHandle</code> 对象。</p><blockquote><p>安全上下文: 此项功能仅在一些支持的浏览器的安全上下文（HTTPS）中可用。</p></blockquote><blockquote><p>实验性: 这是一项实验性技术,在将其用于生产之前，请仔细检查浏览器兼容性表格。</p></blockquote><p>该方法接受一个 <strong>option</strong> 对象参数，该对象包含以下属性：</p><ul><li><strong>mode(可选)</strong>： 选择器模式，可选值为 &quot;read&quot; 或 &quot;readwrite&quot;。默认为 &quot;read&quot;。</li><li><strong>id(可选)</strong>：通过指定 ID，浏览器可以为不同的 ID 记住不同的目录。如果相同的 ID 用于另一个选择器，则该选择器将在同一目录中打开。</li><li><strong>startIn(可选)</strong>： 一个 FileSystemHandle 对象或者代表某个众所周知的目录的字符串（如：&quot;desktop&quot;、&quot;documents&quot;、&quot;downloads&quot;、&quot;music&quot;、&quot;pictures&quot;、&quot;videos&quot;），用于指定选择器的起始目录。</li></ul><p>No BB，实现一下。</p><h2 id="启用https" tabindex="-1"><a class="header-anchor" href="#启用https"><span>启用https</span></a></h2>',8),C={href:"https://qingkaa.github.io/blog/%E6%B5%8F%E8%A7%88%E5%99%A8/vite%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E5%BC%80%E5%90%AFhttps/vite%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E5%BC%80%E5%90%AFhttps.html",target:"_blank",rel:"noopener noreferrer"},f=o('<h2 id="实现" tabindex="-1"><a class="header-anchor" href="#实现"><span>实现</span></a></h2><h3 id="效果图" tabindex="-1"><a class="header-anchor" href="#效果图"><span>效果图</span></a></h3><p>先看效果<br><img src="'+u+'" alt="demo1"><img src="'+k+`" alt="demo"></p><p>点击按钮，弹出选择文件夹的对话框。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">openFolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dirLoading<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>
    dirLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span><span class="token function">showDirectoryPicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;  =====&gt; handle:&#39;</span><span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">processHandler</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span>
        folderTree<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    dirLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>window.showDirectoryPicker</code> 这个操作是异步的，而且在用户取消的时候会抛出异常，所以需要 <code>try catch</code> 包裹。<br> 拿到的 handle 是一个句柄 FileSystemDirectoryHandle, 打印出来看一下长什么样：</p><p><img src="`+d+`" alt="handle"></p><p>OK, 接下来需要递归处理整个文件夹的所有内容，将其转换成一个树形结构。</p><p>定义一个递归函数：<code>processHandler</code>：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">processHandler</span><span class="token punctuation">(</span>handle<span class="token operator">:</span> FileSystemDirectoryHandle <span class="token operator">|</span> FileSystemFileHandle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newHandle<span class="token operator">:</span> FolderOrFileItem <span class="token operator">=</span> <span class="token punctuation">{</span>
        kind<span class="token operator">:</span> handle<span class="token punctuation">.</span>kind<span class="token punctuation">,</span>
        name<span class="token operator">:</span> handle<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        handle<span class="token operator">:</span> handle<span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newHandle<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> newHandle<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> iter <span class="token operator">=</span> <span class="token keyword">await</span> handle<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> info <span class="token keyword">of</span> iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;  =====&gt; info:&#39;</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> subHandle <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">processHandler</span><span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    newHandle<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>subHandle<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newHandle
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前端有一个点很好，有啥可以直接console出来，直观的看到该数据的结构。<br> 打印的info如下： <img src="`+h+`" alt="log-info"><br> info 是一个数组，第一个是文件名，第二个是句柄。句柄有可能是FileSystemDirectoryHandle，也有可能是FileSystemFileHandle。递归的终止条件也是根据这个来处理：文件类型则返回，文件夹类型则继续递归。最后组合成一个树形对象。</p><p>页面的树形使用了 element-plus 的组件。</p><h3 id="读取文件内容" tabindex="-1"><a class="header-anchor" href="#读取文件内容"><span>读取文件内容</span></a></h3><p>读取文件内容那就是非 FileReader 莫属了。</p><p>通过文件的句柄获取文件对象：<code>const file = await (item.handle as FileSystemFileHandle).getFile()</code><br> 通过 FileReader 将文件内容以文本形式读取<br> 最后将内容显示出来</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleNodeClick</span><span class="token punctuation">(</span>item<span class="token operator">:</span> FolderOrFileItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">&quot;directory&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileLoading<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>
    fileLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>handle <span class="token keyword">as</span> FileSystemFileHandle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            activeFileData<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token operator">?.</span>result <span class="token keyword">as</span> <span class="token builtin">string</span>
            fileLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代码高亮" tabindex="-1"><a class="header-anchor" href="#代码高亮"><span>代码高亮</span></a></h3>`,17),S={href:"https://highlightjs.org/",target:"_blank",rel:"noopener noreferrer"},Q=n("h2",{id:"最后",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#最后"},[n("span",null,"最后")])],-1),w=n("p",null,"不得不感叹，前端能做的东西是越来越多。",-1);function R(U,K){const p=t("PostInfo"),e=t("ExternalLinkIcon");return c(),l("div",null,[m,a(p),n("p",null,[n("a",I,[s("demo体验地址"),a(e)])]),n("p",null,[s("网页版vscode有个功能是可以直接访问本地文件夹 "),n("a",E,[s("vscode.dev"),a(e)])]),b,A,y,n("p",null,[n("a",F,[s("MDN说明"),a(e)])]),g,n("p",null,[n("a",C,[s("看这里"),a(e)])]),f,n("p",null,[s("代码高亮用了一个三方库"),n("a",S,[s("highlight.js"),a(e)])]),Q,w])}const _=i(v,[["render",R],["__file","访问文件夹.html.vue"]]),V=JSON.parse('{"path":"/blog/%E6%B5%8F%E8%A7%88%E5%99%A8/%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6%E5%A4%B9/%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6%E5%A4%B9.html","title":"访问文件夹","lang":"zh-CN","frontmatter":{"title":"访问文件夹","author":"清咖","date":"2024-06-16","category":"浏览器"},"headers":[{"level":2,"title":"Window：showDirectoryPicker()","slug":"window-showdirectorypicker","link":"#window-showdirectorypicker","children":[]},{"level":2,"title":"启用https","slug":"启用https","link":"#启用https","children":[]},{"level":2,"title":"实现","slug":"实现","link":"#实现","children":[{"level":3,"title":"效果图","slug":"效果图","link":"#效果图","children":[]},{"level":3,"title":"读取文件内容","slug":"读取文件内容","link":"#读取文件内容","children":[]},{"level":3,"title":"代码高亮","slug":"代码高亮","link":"#代码高亮","children":[]}]},{"level":2,"title":"最后","slug":"最后","link":"#最后","children":[]}],"git":{"updatedTime":1718727875000,"contributors":[{"name":"清咔","email":"874518796@qq.com","commits":2}]},"filePathRelative":"blog/浏览器/访问文件夹/访问文件夹.md"}');export{_ as comp,V as data};
